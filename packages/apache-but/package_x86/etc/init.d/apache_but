#!/bin/sh
#
# Copyright (c) 1997-1998 by Sun Microsystems, Inc.
# All rights reserved.
#

case "$1" in
'start')
        echo "STARTING APACHE_BUT" 
	HL_ETH=`/sbin/ifconfig eth0 | grep 'inet addr:' | cut -d: -f2 | awk '{ print $1}'`
	HL_TUN=`/sbin/ifconfig tun0 | grep 'inet addr:' | cut -d: -f2 | awk '{ print $1}'`
	HL_WLAN=`/sbin/ifconfig wlan0 | grep 'inet addr:' | cut -d: -f2 | awk '{ print $1}'`
	cp /opt/apache_but/httpd/conf/httpd.conf.ori /opt/apache_but/httpd/conf/httpd.conf

	if [ "${HL_ETH}" ]; then
	    perl -p -i -e "s/#Listen HL_ETH/Listen $HL_ETH/g" /opt/apache_but/httpd/conf/httpd.conf
	fi

        if [ "${HL_TUN}" ]; then
	    perl -p -i -e "s/#Listen HL_TUN/Listen $HL_TUN/g" /opt/apache_but/httpd/conf/httpd.conf
        fi

        if [ "${HL_WLAN}" ]; then
            perl -p -i -e "s/#Listen HL_WLAN/Listen $HL_WLAN/g" /opt/apache_but/httpd/conf/httpd.conf
        fi

	grep ^Listen /opt/apache_but/httpd/conf/httpd.conf
	/opt/apache_but/httpd/bin/apachectl -k start
        echo "SHOW IP where the web server is listening" 
	/home/hacker/.scripts/list-ip.sh
	sleep 5;
        ;;

'stop')
        echo "STOPPING APACHE_BUT"
        /opt/apache_but/httpd/bin/apachectl -k stop
	sleep 5;
        ;;

'restart')
        echo "RESTART APACHE_BUT"
        /opt/apache_but/httpd/bin/apachectl -k stop
	sleep 1
        /opt/apache_but/httpd/bin/apachectl -k start
        echo "SHOW IP where the web server is listening"
        /home/hacker/.scripts/list-ip.sh
        sleep 5;
        ;;


'clean')
        echo "RESTARTING & CLEAN LOG FILES OF APACHE_BUT"
        /opt/apache_but/httpd/bin/apachectl -k stop
	sleep 1
        cp /dev/null /opt/apache_but/httpd/logs/access_log
        cp /dev/null /opt/apache_but/httpd/logs/error_log
        /opt/apache_but/httpd/bin/apachectl -k start
        echo "SHOW IP where the web server is listening"
        /home/hacker/.scripts/list-ip.sh
        sleep 5;
        ;;


*)
        echo "Usage: $0 { start | stop | restart | clean }"
        exit 1
        ;;
esac
exit 0

